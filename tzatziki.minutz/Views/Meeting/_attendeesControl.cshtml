@model List<tzatziki.minutz.models.Entities.User>

<style type="text/css">
	.attendeesLabel {
		font-size: 1.2em ;
		font-weight: bold;
		padding: 5px;
		color: white;
	}
	.buttonAdd {
		cursor: pointer;
	}
	.buttonAdd .fa-stack-2x {
		background-color: #0073b7 !important;
		color: #0073b7 !important;
	}
	.buttonAdd .fa-plus {
		color: white !important;
	}
	.select2-container .select2-selection--single {
		min-width: 300px;
	}
</style>
<div class="panel panel-default">
	<a data-toggle="collapse" data-target=".attendeeControl" style="cursor: pointer;">
		<div class="panel-body" style="background-color: darkgrey;">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle-thin fa-stack-2x"></i>
				<i class="fa fa-user fa-stack-1x"></i>
			</span>
			<span class="attendeesLabel">Attendees</span>
			<span id="totalAttenddesIcon" class="label label-info"></span>
		</div>
	</a>
</div>
<div class="panel panel-default collapse attendeeControl">
	<div class="panel-body">
		<div class="row">
			<div class="col-md-10">
				<div class="input-group" data-toggle="tooltip" title="Add or remove attendees to your meeting.">
					<select id="attendees" class="form-control js-example-data-array" ></select>
				</div>
			</div>
			<div id="btnAddAttendee" class="col-md-2" data-toggle="modal" data-target="#attendeeModal">
				<span class="fa-stack fa-lg buttonAdd">
					<i class="fa fa-circle-thin fa-stack-2x"></i>
					<i class="fa fa-plus fa-stack-1x"></i>
				</span>
			</div>
		</div>
	</div>
</div>
<div id="attendeeCollapse" class=" collapse attendeeControl">
	<ul id="attendeeList" class="products-list product-list-in-box"></ul>
</div>
<!-- Modal -->
<div id="attendeeModal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Modal Header</h4>
			</div>
			<div class="modal-body">
				<div class="col-sm-12">
					<table id="example1" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
						<thead>
							<tr role="row">
							<th class="sorting_asc" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" style="width: 222px;">First Name</th>
							<th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending" style="width: 271px;">Last Name</th>
							<th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending" style="width: 241px;">Email</th>
						</thead>
						<tbody>
							<tr role="row" class="odd">
								<td class="sorting_1">Gecko</td>
								<td>Firefox 1.0</td>
								<td>Win 98+ / OSX.2+</td>
								<td>1.7</td>
								<td>A</td>
							</tr>
							<tr role="row" class="even">
								<td class="sorting_1">Gecko</td>
								<td>Firefox 1.5</td>
								<td>Win 98+ / OSX.2+</td>
								<td>1.8</td>
								<td>A</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="col-sm-12">
					<form class="form-horizontal">
						<div class="box-body">
							<div class="form-group">
								<label for="inputEmail3" class="col-sm-2 control-label">Email</label>

								<div class="col-sm-10">
									<input type="email" class="form-control" id="inputEmail3" placeholder="Email" autocomplete="off" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAAXNSR0IArs4c6QAAAPhJREFUOBHlU70KgzAQPlMhEvoQTg6OPoOjT+JWOnRqkUKHgqWP4OQbOPokTk6OTkVULNSLVc62oJmbIdzd95NcuGjX2/3YVI/Ts+t0WLE2ut5xsQ0O+90F6UxFjAI8qNcEGONia08e6MNONYwCS7EQAizLmtGUDEzTBNd1fxsYhjEBnHPQNG3KKTYV34F8ec/zwHEciOMYyrIE3/ehKAqIoggo9inGXKmFXwbyBkmSQJqmUNe15IRhCG3byphitm1/eUzDM4qR0TTNjEixGdAnSi3keS5vSk2UDKqqgizLqB4YzvassiKhGtZ/jDMtLOnHz7TE+yf8BaDZXA509yeBAAAAAElFTkSuQmCC&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
								</div>
							</div>
							<div class="form-group">
								<label for="inputPassword3" class="col-sm-2 control-label">Password</label>

								<div class="col-sm-10">
									<input type="password" class="form-control" id="inputPassword3" placeholder="Password" autocomplete="off" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAAAXNSR0IArs4c6QAAAPhJREFUOBHlU70KgzAQPlMhEvoQTg6OPoOjT+JWOnRqkUKHgqWP4OQbOPokTk6OTkVULNSLVc62oJmbIdzd95NcuGjX2/3YVI/Ts+t0WLE2ut5xsQ0O+90F6UxFjAI8qNcEGONia08e6MNONYwCS7EQAizLmtGUDEzTBNd1fxsYhjEBnHPQNG3KKTYV34F8ec/zwHEciOMYyrIE3/ehKAqIoggo9inGXKmFXwbyBkmSQJqmUNe15IRhCG3byphitm1/eUzDM4qR0TTNjEixGdAnSi3keS5vSk2UDKqqgizLqB4YzvassiKhGtZ/jDMtLOnHz7TE+yf8BaDZXA509yeBAAAAAElFTkSuQmCC&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<div class="checkbox">
										<label>
											<input type="checkbox"> Remember me
										</label>
									</div>
								</div>
							</div>
						</div>
						<!-- /.box-body -->
						<div class="box-footer">
							<button type="submit" class="btn btn-default">Cancel</button>
							<button type="submit" class="btn btn-info pull-right">Sign in</button>
						</div>
						<!-- /.box-footer -->
					</form>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>

	</div>
</div>
<script type="text/javascript">
	var img = "https://lh3.googleusercontent.com/-Me7IFI2HKzM/AAAAAAAAAAI/AAAAAAAARwo/Gc40a_hpsSI/photo.jpg";

	var availibleAttendees = [];

	function deleteAttendee(id) {
		for (var q = 0; q < meeting.MeetingAttendeeCollection.length; q++) {
			var check = meeting.MeetingAttendeeCollection[q];
			if (check.id == id) {
				var index = meeting.MeetingAttendeeCollection.indexOf(q);
				meeting.MeetingAttendeeCollection.splice(index, 1);
				$("#" + check.id).remove();
			}
		}
		$("#totalAttenddesIcon").text(meeting.MeetingAttendeeCollection.length);
	};

	$(function () {
		var meetingId = 0;


		$('#attendees').select2({
			ajax: {
				url: "/Meeting/Attendees?meetingId=" + meetingId,
				dataType: 'json',
				delay: 250,
				data: function (params) {
					return {
						q: params.term, // search term
						page: params.page
					};
				},
				processResults: function (data) {
					availibleAttendees = [];
					availibleAttendees = data;
					var newData = [];
					console.log(data);
					for (var i = 0; i < data.length; i++) {
						newData.push({ id: data[i].identity, text: data[i].fullName });
					}

					return {
						results: newData
					};
				},
				cache: true
			},
			width: '100%'
		});
		$('#attendees').on("select2:select", function (e) {
			var identity = $("#attendees").select2('data')[0].id;
			console.log(identity);
			console.log(meeting.Id);
			for (var i = 0; i < availibleAttendees.length; i++) {
				if (availibleAttendees[i].identity == identity) {
					var x = availibleAttendees[i];
					var guid = minutz.functions.createId();
					var user = {
						active: x.active,
						email: x.email,
						firstName: x.firstName,
						fullName: x.fullName,
						id: guid,
						identity: x.identity,
						Identity: x.identity,
						image: x.image,
						lastName: x.lastName,
						role: x.role,
						Role: x.role,
						personIdentity: x.identity,
						ReferanceId: meeting.Id,
						referanceId: meeting.Id,
						Id: x.id
					};
					for (var q = 0; q < meeting.MeetingAttendeeCollection.length; q++) {
						var check = meeting.MeetingAttendeeCollection[q];
						if (check.identity == x.identity) {
							var index = meeting.MeetingAttendeeCollection.indexOf(q);
							meeting.MeetingAttendeeCollection.splice(index, 1);
							$("#" + check.id).remove();
						}
					}
					console.log(user);
					meeting.MeetingAttendeeCollection.push(user);
					console.log(meeting.MeetingAttendeeCollection);
					$("#attendeeList").append(createUserListItem(user));
					$("#totalAttenddesIcon").text(meeting.MeetingAttendeeCollection.length);
				}
			}
		});


		$("#btnAddAttendee").click(function () {

			

			
			//add user to meeting object
		});

		function createUserListItem(user) {
			return '<li id="' + user.id + '" class="item">'
				+ '<div class="product-img">'
				+ '<img class="img-circle" height="50" width="50" style="margin-left: 5px;" src="' + user.image + '" alt="Product Image">'
				+ '</div>'
				+ '<div class="product-info">'
				+ '<a href="javascript:void(0)" class="product-title">' + user.fullName
				+ '</a>'
				+ '<span class="product-description">'
				+ '<b>Role :</b>' + user.role
				+ '</span>'
				+ '<i class="fa fa-trash fa-2x pull-right" style="margin-top: -30px; margin-right: 10px; cursor: pointer;color: grey; " aria-hidden="true" onclick="deleteAttendee(' + user.id + ')" ></i>'
				+ '</div>'
				+ '</li>';
		};


		if (document.location.search.length) {
			var id = document.location.search.split("=")[1];
			$.ajax({
				type: minutz.properties.GET,
				url: document.location.origin + "/Meeting/Attendees?meetingId=" + id,
				success: function (data) {
					var users = data;
					var url = document.location.origin + "/Meeting/GetMeeting?id=" + id;
					$.ajax({
						type: minutz.properties.GET,
						url: url,
						success: function (data) {
							console.log(data);
							for (var attendeeIdex = 0; attendeeIdex < data.meetingAttendeeCollection.length; attendeeIdex++) {
								var userId = data.meetingAttendeeCollection[attendeeIdex].personIdentity;

								for (var orginalUserIndex = 0; orginalUserIndex < users.length; orginalUserIndex++) {
									if (userId == users[orginalUserIndex].identity)
									{
										$("#attendeeList").append(createUserListItem(users[orginalUserIndex]));
									 }
								}
							}
							$("#totalAttenddesIcon").text(data.meetingAttendeeCollection.length);
						},
						error: function (XMLHttpRequest, textStatus, errorThrown) {
							//minutz.functions.notifyMe(MinutzTitle, textStatus + "  " + errorThrown, minutz.properties.infoIcon);
						},
						dataType: minutz.properties.JSON
					});
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					//minutz.functions.notifyMe(MinutzTitle, textStatus + "  " + errorThrown, minutz.properties.infoIcon);
				},
				dataType: minutz.properties.JSON
			});
		}

	});

	function getUrlVars() {
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		for (var i = 0; i < hashes.length; i++) {
			hash = hashes[i].split('=');
			vars.push(hash[0]);
			vars[hash[0]] = hash[1];
		}
		return vars;
	}


</script>